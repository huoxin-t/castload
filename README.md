# CastBox 播客下载管理器

一个功能完整的播客下载和管理系统，支持从CastBox.fm网站提取播客列表、下载音频文件、管理下载历史和重新下载功能。

## 功能介绍

### 核心功能
1. **播客列表提取** - 自动从CastBox.fm频道提取所有播客节目信息
2. **播客下载** - 支持批量下载播客音频文件
3. **下载管理** - 提供下载历史记录查看和管理
4. **重新下载** - 支持重新下载已下载的播客文件
5. **状态跟踪** - 实时跟踪下载状态，避免重复下载

### 特色功能
1. **智能重复处理** - 重新下载时自动为文件添加序号避免覆盖
2. **确认机制** - 重新下载前显示确认对话框，防止误操作
3. **数据库管理** - 使用SQLite数据库存储播客和下载信息
4. **Web界面** - 提供友好的Web界面进行操作和管理

## 技术栈

### 后端技术
- **Python 3.8+** - 主要编程语言
- **Flask** - Web框架，用于构建REST API和Web界面
- **SQLite** - 轻量级数据库，存储播客和下载信息
- **Requests** - HTTP库，用于网络请求

### 前端技术
- **HTML5/CSS3** - 页面结构和样式
- **JavaScript** - 前端交互逻辑
- **Bootstrap** - 响应式设计框架

### 开发工具
- **Playwright** - 网页抓取工具（用于提取播客列表）
- **pip** - Python包管理工具

## 启动步骤

### 环境准备
1. 确保已安装Python 3.8或更高版本
2. 安装项目依赖：
```bash
pip install -r requirements.txt
```

### 配置设置
1. 打开 `core/config.py` 文件
2. 根据需要修改以下配置：
   - `LIST_PAGE_URL`: CastBox.fm频道页面URL
   - `DOWNLOAD_DIR`: 下载文件存储目录
   - `TEST_MODE`: 是否启用测试模式

### 环境变量配置（推荐）
为了在不同环境中灵活配置，建议使用环境变量：

- `PODCAST_DOWNLOAD_DIR`: 下载目录路径，默认为 `download`
- `PODCAST_MAX_WORKERS`: 最大并发下载数，默认为 `3`
- `PODCAST_TEST_MODE`: 测试模式开关，设置为 `False` 可关闭测试模式

在Linux/macOS系统中设置环境变量示例：
```bash
export PODCAST_DOWNLOAD_DIR="/path/to/your/download/directory"
export PODCAST_MAX_WORKERS="5"
export PODCAST_TEST_MODE="False"
```

在Windows系统中设置环境变量示例：
```cmd
set PODCAST_DOWNLOAD_DIR=C:\path\to\your\download\directory
set PODCAST_MAX_WORKERS=5
set PODCAST_TEST_MODE=False
```

### 启动应用
1. 运行主应用：
```bash
python app.py
```

2. 打开浏览器访问：http://127.0.0.1:5000

### 使用流程
1. **提取播客列表**：
   - 访问首页，点击"获取播客列表"按钮
   - 或运行命令：`python import_podcasts.py --get-list`

2. **下载播客**：
   - 在首页点击"开始下载所有播客"按钮
   - 或运行命令：`python import_podcasts.py`

3. **查看和管理**：
   - 访问"历史记录"页面查看下载状态
   - 对于已下载的播客，可以点击"重新下载"按钮进行重新下载

## 技术思考（G5 亮点）

### 1. 架构设计亮点
- **模块化设计**：采用清晰的分层架构，将业务逻辑、数据访问和Web接口分离，便于维护和扩展
- **单一职责原则**：每个模块和类都有明确的职责，如`PodcastExtractor`专门负责提取播客信息，`PodcastDownloader`专门负责下载
- **可配置性**：通过`Config`类集中管理配置项，便于根据不同环境调整参数

### 2. 功能实现亮点
- **智能文件处理**：重新下载时自动检测文件是否存在，并添加序号避免覆盖，提升用户体验
- **状态一致性**：通过数据库事务确保下载状态和文件系统状态的一致性
- **用户友好交互**：重新下载前的确认对话框设计，防止用户误操作

### 3. 技术选型亮点
- **轻量级方案**：选择Flask+SQLite的组合，无需复杂的部署环境，适合个人使用场景
- **现代化工具链**：使用Playwright进行网页抓取，相比传统工具更加稳定和强大
- **前后端分离友好**：REST API设计清晰，便于后续扩展为前后端完全分离的架构

### 4. 错误处理亮点
- **异常捕获**：在网络请求、文件操作等关键环节都有完善的异常处理机制
- **用户提示**：对于各种异常情况都有友好的用户提示，便于问题排查
- **数据完整性**：通过数据库约束和事务处理确保数据完整性

### 5. 可维护性亮点
- **代码注释**：关键函数和复杂逻辑都有详细注释
- **命名规范**：采用清晰的命名规范，提高代码可读性
- **易于扩展**：模块化设计使得添加新功能变得简单，如可以轻松添加新的下载源支持